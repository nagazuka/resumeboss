<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="utf-8">
  <title>ResumeBoss - Generate beautiful resumes from your LinkedIn profile</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" />
  <link href="bootstrap/css/bootstrap-responsive.css" rel="stylesheet">
  <link href='http://fonts.googleapis.com/css?family=Oxygen' rel='stylesheet' type='text/css'>

  <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
  <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
  <script src="lib/spin.min.js" type="text/javascript"></script>

  <script type="text/javascript">
    function onLinkedInLoad() {
      IN.Event.on(IN, "auth", loadData);
    }
  </script>

  <script type="text/javascript" src="http://platform.linkedin.com/in.js">
    api_key: egfb1tl2aygo
    onLoad: onLinkedInLoad
    authorize: true
  </script>

  <script type="text/javascript">

    function getSummaryStr(text) {
      var str = "";
      if (text) {
        str = text.replace(/\n/g, "<br />");
      }
      return str;
    }

    function getDateStr(dateObj) {
      var str = "";
      if (dateObj) {
        if (dateObj.month) {
          str += dateObj.month;
          str += "-";
        }
        if (dateObj.year) {
          str += dateObj.year;
        }
      }
      return str;
    }

    function scrollTo(elementId) {
      var el = $(elementId).get(0);
      el.scrollIntoView();
    }

    function createSpinner(elementId) {
      var opts = {
        top: 0,
        left: 0
      };
      var target = $(elementId).get(0);
      var spinner = new Spinner(opts).spin(target);
      return spinner;
    }

    function loadData() {
      $("#step1-status").text("Done!");
      $("#step1-status").addClass("label-success");

      $("#step2-status").text("Loading...");
      $("#step2-status").removeClass("hide");
      $("#step2-row").removeClass("hide");

      var step2Spinner = createSpinner('#step2-spinner');

      IN.API.Profile("me")
      .fields("firstName", "lastName", "headline","summary", "specialties", "skills", "certifications", "educations", "courses", "volunteer","date-of-birth","main-address", "picture-url","public-profile-url", "industry", "positions")
      .result(function(result) {

        var profile = result.values[0];
        var profHTML = "<h2>" + profile.firstName + " " + profile.lastName + "</h2>"; 
        profHTML += "<h4>" + profile.headline + "</h4>"; 
        profHTML += " <button class='close' data-dismiss='alert'>×</button>"
        profHTML += "<p><h6>Summary</h6>"+profile.summary+"</p>";

        profHTML += "<h3>Experience</h3>"; 
        var positions = profile.positions.values;
        $.each(positions, function(index, item) {
          profHTML += " <button class='close' data-dismiss='alert'>×</button>"
          profHTML += "<h4>" + item.company.name + "</h4>"; 
          profHTML += "<h4><small>" + getDateStr(item.startDate) + " - "+ getDateStr(item.endDate) + "</small></h4>"; 
          profHTML += "<p>" + getSummaryStr(item.summary) + "</p>"; 
        });

        profHTML += "<h3>Education</h3>"; 
        var educations = profile.educations.values;
        $.each(educations, function(index, item) {
          profHTML += " <button class='close' data-dismiss='alert'>×</button>"
          profHTML += "<h4>" + item.schoolName + "</h4>"; 
          profHTML += "<h4><small>" + getDateStr(item.startDate) + " - "+ getDateStr(item.endDate) + "</small></h4>"; 
          profHTML += "<p>" + item.fieldOfStudy + ", " + item.degree + "</p>"; 
          profHTML += "<p>" + getSummaryStr(item.notes) + "</p>"; 
        });

        profHTML += " <button class='close' data-dismiss='alert'>×</button>"
        profHTML += "<h3>Certifications</h3>"; 
        profHTML += "<ul>";
        var certifications = profile.certifications.values;
        $.each(certifications, function(index, item) {
          profHTML += "<li>" + item.name + "</li>"; 
        });
        profHTML += "</ul>";

        profHTML += " <button class='close' data-dismiss='alert'>×</button>"
        profHTML += "<h3>Skills</h3>"; 
        profHTML += "<p>";
        var skills = profile.skills.values;
        $.each(skills, function(index, item) {
          profHTML += item.skill.name + "   "; 
        });
        profHTML += "</p>";

        step2Spinner.stop();
        $("#step2-status").text("Not yet reviewed");
        $("#profile").html(profHTML);

        //Show confirm buttons after loading
        var confirmButton = $("#step3-generate")
        confirmButton.on("click", function() {
          generateResume(profile);
          return false;
        });
        confirmButton.removeClass("hide");
        
        var debugHTML = "<h3>Debug</h3>"; 
        debugHTML += "<code>" + JSON.stringify(result) + "</code>";
        $("#debug").html(debugHTML);
      });

      function generateResume(profile) {
        $("#step2-status").text("Done!");
        $("#step2-status").addClass("label-success");
        $("#step3-row").addClass("hide");
        $("#step3-spinner").empty();

        $("#step3-status").text("Loading...");
        var step3Spinner = createSpinner('#step3-spinner');
        scrollTo("#step3-spinner");

        $("#step3-status").removeClass("hide");
        var profStr = JSON.stringify(profile);
        
        var request = $.ajax({
          url: "/generate",
          type: "POST",
          data: {'template': 'modern-cv', 'profile': profStr},
        });

        request.done(function(data) {
          var file = data;
          var linkHTML = "<p><a href='download/" + file + "' target='_blank'><img src='images/pdf1.png'></a></p>"; 
          linkHTML += "<p><a href='download/" + file + "' target='_blank'>Download resume</a></p>"; 
          step3Spinner.stop(); 
          $("#step3-download-link").html(linkHTML);
          $("#step3-download-link").removeClass("hide");
          $("#step3-status").text("Done!");
          $("#step3-status").addClass("label-success");
          $("#step3-row").removeClass("hide");
          scrollTo("#step3-download-link");
        });

        request.fail(function(jqXHR, textStatus) {
          step3Spinner.stop(); 
          alert( "Request failed: " + textStatus + ", status code " + jqXHR.status );
        });

        /*
        $.post('/generate', {'template': 'plain-cv', 'profile': profStr}, function(data, status, xhr){
          alert('status ' + status);
          var file = data;
          var linkHTML = "<p><a href='download/" + file + "' target='_blank'><img src='images/pdf1.png'></a></p>"; 
          linkHTML += "<p><a href='download/" + file + "' target='_blank'>Download resume</a></p>"; 
          step3Spinner.stop(); 
          $("#step3-download-link").html(linkHTML);
          $("#step3-download-link").removeClass("hide");
          $("#step3-status").text("Done!");
          $("#step3-status").addClass("label-success");
          $("#step3-row").removeClass("hide");
          scrollTo("#step3-download-link");
        })
        */
        return false;
      }
    }
  </script>

</head>
<body>
  <div class="container">
    <div class="page-header">
      <h1>Resume<span style="color: red;">Boss</span> <small>Creates resumes....<i>like a boss</i></small>
      </h1>
    </div>
    <div id="step1-row" class="row">
      <div class="span4">
        <h2>Step 1 <small>Sign in</small></h2>
        <p>
        Please sign in with LinkedIn, so we can retrieve your resume content. We won't store, sell or print your details and hang it above our bed, see our <a href="#privacy">Privacy Policy</a>. But <em>seriously</em>, this won't work without signing in with LinkedIn. 
        </p>
      </div>
      <div class="span5 offset1">
        <p>
          <span id="step1-status" class="label">Not yet signed in</span>
        </p>
        <p>
        <script type="in/Login">
          Hey, you're logged in! This is <strong><?js= firstName ?> <?js= lastName ?></strong>, right? Let's continue then...
        </script>
        </p>
      </div>
    </div>
    <div id="step2-row" class="row hide">
      <div class="span4">
        <h2>Step 2 <small>Review</small></h2>
        <p>
          Just go through everything we loaded from your profile and tell us whether you want it ending up in the resume. 
        </p>
      </div>
      <div class="span5 offset1">
        <p>
          <span id="step2-status" class="label hide">Not yet reviewed</span>
        </p>
        <div id="step2-spinner">&nbsp;</div>
        <div id="profile"></div>
        <br />
        <p>
          <a id="step3-generate" class="btn btn-success hide" href="#"><i class="icon-play icon-white"></i> Generate resume</a>
          <div id="step3-spinner">&nbsp;</div>
        <p>
      </div>
    </div> 
    <div id="step3-row" class="row hide">
      <div class="span4">
        <h2>Step 3 <small>Download</small></h2>
        <p>Your resume is ready! Click the link to download the PDF file. Good luck with job hunting!</p>
      </div>
      <div class="span5 offset1">
          <p>
            <span id="step3-status" class="label hide">Not yet generated</span>
          </p>
          <br />
          <div id="step3-download-link" class="well hide">&nbsp;</div>
      </div>
    </div>
    <div id="debug-row" class="row hide">
      <div id="debug" class="span10">
      </div>
    </div>
  </div>
  <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-642674-6']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

  </script>
</body>
</html>
